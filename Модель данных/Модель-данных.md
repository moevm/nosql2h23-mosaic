# Нереляционная модель
## Графическое представление модели
![Графическое представление модели](https://github.com/moevm/nosql2h23-mosaic/blob/main/%D0%9C%D0%BE%D0%B4%D0%B5%D0%BB%D1%8C%20%D0%B4%D0%B0%D0%BD%D0%BD%D1%8B%D1%85/NoSQLmodel.png)
## Описание назначений
### Узлы:
1. User - предназначен для хранения каждого пользователя. Узел имеет **метки**:
   - *eMail: String* - хранит адрес электронной почты.
   - *password: String* - хранит пароль пользователя.
2. Tile - предназначен для хранения информации о плитке мозаики. Узел имеет **метки**:
   - *shape: String* - хранит информацию о форме плитки.
   - *colour: String* - хранит цвет плитки.
   - *possition: String* - хранит информации о позиции плитки.
3. Mosaic - предназначен для хранения мозаик. Имеет **метку** *name: String*, 
которая хранит название мозаики. 	
### Отношения:
1. Selected - взаимосвязь, предназначена для описания мозаик, которые видны пользователю - то есть те, которые он выбрал для воспроизведения. Данное отношение имеет атрибуты:
   - *dateCreated: String* - для хранения момента создания мозаики;
   - *dateEdited: String* - для хранения момента последнего редактирования;
   - *progress: Integer* - для отслеживания прогресса воспроизведения мозаик.
2. Includes - взаимосвязь, показывающая плитки, принадлежащие определённой мозаике.
3. Neighbour - взаимосвязь, показывающая плитки, являющиеся соседями.
## Оценка удельного объема информации в модели и скорость её роста
Neo4j для хранения данных использует фиксированное количество памяти для хранения каждой сущности:
- 15 байт для хранения каждого узла;
- 34 байта для хранения каждого отношения;
- 41 байт для хранения атрибутов узлов и отношений;
- 128 байт для хранения строчных атрибутов.

Следовательно, для хранения: 
- узла *User* с его атрибутами требуется - 15 + 128 \* 2 = 271 байт;
- узла *Mosaic* с его атрибутами требуется - 15 + 128 = 143 байта;
- узла *Tile* с его атрибутами требуется - 15 + 128 \* 3 = 399 байт;
- отношения *Selected* с его атрибутами требуется - 34 + 41 + 128 \* 2 = 331 байт;
- отношения *Includes* с его атрибутами требуется - 34 байта;
- отношения *Neighbour* с его атрибутами требуется - 34 байта.

Пусть количество пользователей - U,
количество мозаик пользователя - uM,
среднее число плиток в мозаике - T,
количество соседей плитки - tN.
Тогда чистый объём базы данных можно оценить следующим образом:
<br>`271*U+331*uM+143*M+339*T*M+34*T*M+34*tN`, где M - общее число мозаик.
<br>Рост будет происходить линейным образом.

Если принять среднее значения uM = 5 мозаик, U = 50 пользователей, T = 2500 плиток, tN = 8 соседей,
то в получившейся базе данных будет зависимость:
<br>`size = 1082643*M + 15477 байт`

Если принять, что в системе будет 250 уникальных мозаик, то общий объём получится: 
1082643 \* 250 + 15477 = 258,1 мегабайт.

## Избыточность модели
Для того, чтобы Neo4j могла использовать смещение, данные хранятся в фиксированном объёме памяти - 
для любого строкового атрибута выделяется 128 байт, несмотря на его размер.
Следовательно, в общем случае фактический объём модели сильно больше "чистого" объёма.
В среднем, такая система хранения переменных типа *String* увеличивает объём модели на 400 байт за каждую уникальную мозаику.  
То есть `realSize = idealSize + 400M`. Таким образом, реальный объём БД в 1,000001 раз больше идеального.
## Направление роста модели
Исходя из предыдущего пункта, можно сделать вывод, что модель обладает линейным ростом, так как при создании узла или отношения выделяется константное количество памяти.
## Запросы к модели
### Создание узла User
> CREATE (user:User { eMail : 'example@etu.ru', password : 'RushE123' })
### Создание узла Mosaic
> CREATE (mosaic:Mosaic { cfg : 'mosaics/mosaic1.mosaic'})
### Создание отношения
> MATCH (m:mosaic {cfg: 'mosaics/mosaic1.mosaic'}), (u:user {eMail: 'example@etu.ru'}) MERGE (u)-[:Selected {dateCreated: '23.10.2023', dateEdited: '24.10.2023', progress: 47}]->(m)
### Поиск всех активных мозаик пользователя
> MATCH (u:user {eMail: 'example@etu.ru'})-[:Selected]->(m:mosaic) RETURN m
# Реляционная модель
## Графическое представление модели
![Графическое представление модели](https://github.com/moevm/nosql2h23-mosaic/blob/b7d984f4226794f3aec1da4bb685edf30977d585/%D0%9C%D0%BE%D0%B4%D0%B5%D0%BB%D1%8C%20%D0%B4%D0%B0%D0%BD%D0%BD%D1%8B%D1%85/SQLmodel.png)
## Оценка удельного объема информации, хранимой в модели
1. Таблица User:
    - id - INT -> 4 байта
    - eMail - VARCHAR(255) -> 255 байт
    - password - VARCHAR(255) -> 255 байт
2. Таблица Mosaic:
   - id - INT -> 4 байта
   - path - VARCHAR(255) -> 255 байт
3. Таблица Map:
   - userId - INT -> 4 байта
   - mosaicId - INT -> 4 байта
   - dateCreated - VARCHAR(255) -> 255 байт
   - dateEdited - VARCHAR(255) -> 255 байт
   - progress - INT -> 4 байта

Возьмём те же показатели, что и при оценке объема данных в нереляционной модели (50 пользователей, 250 уникальных мозаик):  
V = 50 \* (4 + 255 + 255) + 250 \* (4 + 255) + 250 \* (4 + 4 + 255 + 255) = 214,7 КБ.
## Избыточность модели

Будем считать, что символ строки будет занимать 4 байта, 
а среднее количество символов в строке возьмём за 25. То есть чистый объём данных будет равен:

Vч = 50 \* (4 + 100 + 100) + 250 \* (4 + 100) + 250 \* (4 + 4 + 100 + 100) = 86,1 КБ.
Следовательно, фактический объём больше чистого в `214,7 / 86,1 = 2.49` раза.

## Запросы к модели
### Создание узла User
> INSERT INTO Users VALUES ('example@etu.ru', 'RushE123')
### Создание узла Mosaic
> INSERT INTO Mosaics VALUES ('mosaics/mosaic1.mosaic')
### Создание связи
> SELECT Users.id, Mosaics.id FROM Users, Mosaics WHERE Users.eMail IN("example@etu.ru”) AND Mosaics.path = 'mosaics/mosaic1.mosaic' getting id_1, id_2 and create query: INSERT INTO Map Values (id_1, id_2, '23.10.2023', '24.10.2023', 47)
### Поиск всех активных мозаик пользователя
> SELECT id FROM Users WHERE eMail IN("example@etu.ru”) getting user_id
> SELECT mosaicId FROM Map WHERE userId == user_id getting mosaic_ids
> SELECT path FROM Mosaics WHERE id IN mosaic_ids
  
Количество запросов: 3.  

# Сравнение моделей
## Удельный объем информации
- В реляционной реализации модели данных пришлось бы создавать дополнительные таблицы для связей, что увеличивает суммарное количество создаваемых таблиц.
- В реляционной версии придётся хранить конфигурационный файл для мозаики, ссылка на который будет храниться в таблице. 
Такая схема хранения добавит сложностей с отображением мозаики.
## Запросы
- Количество запросов, необходимых для выполнения юзкейсов реляционнойQL модели больше.
## Вывод
Для выполнения поставленной задачи выгодней использовать нереляционную модель.